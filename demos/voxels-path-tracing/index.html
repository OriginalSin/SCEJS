<html>
	<head>
		<title>SCEJS Voxel Path Tracing</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
    
		<script src="../../SCEJS/SCE.class.js"></script>

		<script src="../../SCEJS/Prefabs/SimpleCamera/SimpleCamera.class.js"></script>

	    <script src="../../SCEJS/Prefabs/Grid/VFP_GRID.class.js"></script>
	    <script src="../../SCEJS/Prefabs/Grid/Grid.class.js"></script>
	
	
	    <script src="../../SCEJS/Prefabs/Voxelizator/VFP_Voxelizator.class.js"></script>
	    <script src="../../SCEJS/Prefabs/Voxelizator/Voxelizator.class.js"></script>
	    
	    <script src="../../SCEJS/Prefabs/GI/VFP_GI.class.js"></script>
	    <script src="../../SCEJS/Prefabs/GI/SE_GI.class.js"></script>
	    <script src="../../SCEJS/Prefabs/GI/GI.class.js"></script>	    
	</head>

	<body>
		<div id="SCEJS"></div>

		<button id="BTNID_makeVoxels">make voxels</button><br />
		
		<script>
			var sce = new SCE();
			sce.initialize({"target": document.getElementById("SCEJS"),
							"dimensions": {"width": 512, "height": 512}});


			var project = new Project();
			sce.loadProject(project);

			var stage = new Stage();
			project.addStage(stage);
			project.setActiveStage(stage);

			// CAMERA
			var simpleCamera = new SimpleCamera(sce);

			// GRID
			var grid = new Grid(sce);
			grid.generate(100.0, 1.0);


			// VOXELIZATOR & GI PREFABS
			var _gridSize = 10.1, _resolution = 64;
			var OFFSET = 1000.0;
			
			var voxelizator = new Voxelizator(sce);
			var gi = new GI(sce);
			gi.setResolution(_resolution);
			gi.setGridSize(_gridSize);			
			
			var mesh = new Mesh().loadObj("../_RESOURCES/cornellBox3wall.obj", (function(mesh, textures) {
				voxelizator.setMesh(mesh);
				voxelizator.setImage("../_RESOURCES/cartman08.jpg"); 
				
				gi.setMesh(mesh);
				gi.setImage("../_RESOURCES/cartman08.jpg"); 				
			}).bind(this));
			





			//*********
			// RENDER STAGE
			//*********
			project.getActiveStage().render();


			window.onresize = (function() {
				//sce.setDimensions(512, 128);
		    }).bind(this);
			
 
			document.getElementById("BTNID_makeVoxels").addEventListener("click", (function() {
				voxelizator.generate({	"size": _gridSize,
										"resolution": _resolution,
										"fillmode": ["albedo","positionX","positionY","positionZ","normal"],
										"ongenerate": function() {
											var images = voxelizator.getGeneratedImages();
											for(var key in images) {
												document.body.appendChild(images[key]);
											}
											
											gi.setVoxelsArrays(voxelizator.getGeneratedArrays());											
											gi.runGI();
										}
									});
			}).bind(this));
		</script>

	</body>
</html>
