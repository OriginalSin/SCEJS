<html>
	<head>
		<title>SCEJS Draft</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<script src="../SCEJS/SCE.class.js"></script> 
		<script src="../SCEJS/Prefabs/SimpleCamera.class.js"></script>
		<script src="../SCEJS/Prefabs/SimpleNode.class.js"></script>
		<script src="../SCEJS/Prefabs/Graph.class.js"></script>
		
		<link rel=stylesheet href="../SCEJS/UI/codemirror/doc/docs.css">

		<link rel="stylesheet" href="../SCEJS/UI/codemirror/lib/codemirror.css">
		<link rel="stylesheet" href="../SCEJS/UI/codemirror/addon/dialog/dialog.css">
		<link rel="stylesheet" href="../SCEJS/UI/codemirror/addon/hint/show-hint.css">
		<link rel="stylesheet" href="../SCEJS/UI/codemirror/addon/tern/tern.css">
		<script src="../SCEJS/UI/codemirror/lib/codemirror.js"></script>
		<script src="../SCEJS/UI/codemirror/mode/javascript/javascript.js"></script>
		<script src="../SCEJS/UI/codemirror/addon/dialog/dialog.js"></script>
		<script src="../SCEJS/UI/codemirror/addon/hint/show-hint.js"></script>
		<script src="../SCEJS/UI/codemirror/addon/tern/tern.js"></script>
		
		<script src="//ternjs.net/node_modules/acorn/dist/acorn.js"></script>
		<script src="//ternjs.net/node_modules/acorn/dist/acorn_loose.js"></script>
		<script src="//ternjs.net/node_modules/acorn/dist/walk.js"></script>
		<script src="//ternjs.net/doc/demo/polyfill.js"></script>
		<script src="//ternjs.net/lib/signal.js"></script>
		<script src="//ternjs.net/lib/tern.js"></script>
		<script src="//ternjs.net/lib/def.js"></script>
		<script src="//ternjs.net/lib/comment.js"></script>
		<script src="//ternjs.net/lib/infer.js"></script>
		<script src="//ternjs.net/plugin/doc_comment.js"></script>    
	</head>
	
	<body>
		
		<div id="SCEJS"></div> 
		<script id="cod">
			var defs = [];
			var load = (function(defs, url) {
				var req = new XMLHttpRequest();
			    req.open("get", url, true);
			    req.onload = (function(defs, e) {
			    	defs.push(JSON.parse(e.target.responseText));
			    	if(defs.length == 2) load("../SCEJS/UI/SCEJS.json");
				}).bind(this, defs);
			    req.send(null);
			}).bind(this, defs);
			load("//ternjs.net/defs/ecma5.json"); 
			load("//ternjs.net/defs/browser.json");
			
			
			var meshNode = new Mesh().loadBox();
			var edgeColor_origin = [(255.0/255.0), (0.0/255.0), (0.0/255.0)];
			var edgeColor_target = [(0.0/255.0), (255.0/255.0), (0.0/255.0)];
			
			/**
			 * @typedef {Object} NodeObj
			 * @property {String} rid - 
			 * @property {Array<Float3>} position - new Array(){RANDOM, RANDOM, RANDOM}]] 
			 * @property {Array<Float3>} color - [RANDOM, RANDOM, RANDOM]]
			 */
			/**
			 * addNodes
			 * @param {Array<NodeObj>} arrayJson
			 * @param {String} createLinkFromNodeRid
			 */
			this.addNodes = function(arrayJson, createLinkFromNodeRid) {	
				for(var n=0; n < arrayJson.length; n++) {
					var offs = graph.offset/10;
					var arrPos = arrayJson[n].position != undefined ? arrayJson[n].position : [-(offs/2)+(Math.random()*offs), -(offs/2)+(Math.random()*offs), -(offs/2)+(Math.random()*offs)];
					var arrColor = arrayJson[n].color != undefined ? arrayJson[n].color : [Math.random(), Math.random(), Math.random()];
							
					var node = graph.addNode({
						"name": arrayJson[n].rid.toString(),
						"data": arrayJson[n],
						"position": $V3([arrPos[0], arrPos[1], arrPos[2]]),
						"node": meshNode,
						"color": $V3([arrColor[0], arrColor[1], arrColor[2]]),
						"onmouseup": (function(nodeData) {
							
					}).bind(this)});
					
			    	
				}
				graph.updateNodes();
				
				if(createLinkFromNodeRid != undefined) {
					for(var n=0; n < arrayJson.length; n++) {		
						this.addLinks([{"origin": createLinkFromNodeRid,
										"target": arrayJson[n].rid.toString(),
										"origin_color": edgeColor_origin,
										"target_color": edgeColor_target,
										"directed": true}]);
					}
				}
			};
	
			/**
			 * @typedef {Object} LinkObj
			 * @property {String} origin - 
			 * @property {String} target - 
			 * @property {Array<Float3>} origin_color - =[1.0, 0.0, 0.0] 
			 * @property {Array<Float3>} target_color - =[0.0, 1.0, 0.0] 
			 * @property {Bool} directed - =false 
			 */
			/**
			 * addLinks
			 * @param {Array<LinkObj>} arrayJson
			 */
			this.addLinks = function(arrayJson) {	
				for(var n=0; n < arrayJson.length; n++) {		
					graph.addLink({	"origin": arrayJson[n].origin,
									"target": arrayJson[n].target,
									"origin_color": arrayJson[n].origin_color || edgeColor_origin,
									"target_color": arrayJson[n].target_color || edgeColor_target,
									"directed": arrayJson[n].directed || false});
				}
				graph.updateLinks();
			};
		
		
		
		
		
			var sce = new SCE();
			sce.initialize({"target": document.getElementById("SCEJS"),
							"dimensions": {"width": 512, "height": 512}});
			
			
			var project = new Project();	
			sce.loadProject(project);
			
			var stage = new Stage();			
			project.addStage(stage);
			project.setActiveStage(stage);
			
			// CAMERA
			var simpleCamera = new SimpleCamera(sce);
						
			// NODE
			var simpleNode = new SimpleNode(sce); 
			simpleNode.setImage("../demos/_RESOURCES/cartman08.jpg");
			
			
			// GRAPH
			var graph = new Graph(sce);			
			var numNodes = 500; 
			var numLinks = 500; 
			
			var arrayJson = [];
			for(var n=0; n < numNodes; n++) {		
				arrayJson.push({
					"rid": "#"+n.toString()+":"+n.toString()
					});
			}
			this.addNodes(arrayJson, undefined);
			
			arrayJson = [];
			for(var n=0; n < numLinks; n++) {
				var A = parseInt(Math.random()*numNodes).toString();
				var B = parseInt(Math.random()*numNodes).toString();
				
				arrayJson.push({"origin": "#"+A+":"+A,
								"target": "#"+B+":"+B,
								"origin_color": edgeColor_origin,
								"target_color": edgeColor_target,
								"directed": true});
			}
			this.addLinks(arrayJson);
			
			//*********
			// RENDER STAGE
			//*********
			project.getActiveStage().render();
			
			
			window.onresize = (function() {
				//sce.setDimensions(512, 128);
		    }).bind(this);
		</script>
	</body>
</html>
